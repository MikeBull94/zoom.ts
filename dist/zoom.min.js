/*!
 * zoom.ts v3.0.2
 * https://michael-bull.com/projects/zoom.ts
 * 
 * Copyright (c) 2016 Michael Bull (https://michael-bull.com)
 * Copyright (c) 2013 @fat
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.zoom=t.zoom||{})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var n="zoom-overlay",o=function(){function t(){this._element=document.createElement("div"),this._state="hidden",this._element.className=n}return t.prototype.add=function(){document.body.classList.add(n+"-"+this._state),document.body.appendChild(this._element)},Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(t){document.body.classList.remove(n+"-"+this._state),this._state=t,document.body.classList.add(n+"-"+this._state)},enumerable:!0,configurable:!0}),t}(),i="data-zoom",r="zoom-in",s="zoom-out",d="data-zoom-src",c="data-zoom-play",a="always",u=function(){function t(){}return t.scrollX=function(){return void 0===window.pageXOffset?(document.documentElement||document.body).scrollLeft:window.pageXOffset},t.scrollY=function(){return void 0===window.pageYOffset?(document.documentElement||document.body).scrollTop:window.pageYOffset},t.viewportWidth=function(){return void 0===window.innerWidth?(document.documentElement||document.body).clientWidth:window.innerWidth},t.viewportHeight=function(){return void 0===window.innerHeight?(document.documentElement||document.body).clientHeight:window.innerHeight},t}(),l=["transitionend","webkitTransitionEnd","oTransitionEnd"],h=function(){function t(){}return t.repaint=function(t){t.offsetWidth},t.transform=function(t,e){t.style.webkitTransform=e,t.style.transform=e},t.removeTransform=function(t){t.style.removeProperty("webkitTransform"),t.style.removeProperty("transform")},t.addTransitionEndListener=function(t,e){if("transition"in document.body.style)for(var n=0,o=l;n<o.length;n++){var i=o[n];t.addEventListener(i,e)}else e(void 0)},t.removeTransitionEndListener=function(t,e){for(var n=0,o=l;n<o.length;n++){var i=o[n];t.removeEventListener(i,e)}},t.translateToCenter=function(t){var e=u.viewportWidth(),n=u.viewportHeight(),o=u.scrollX(),i=u.scrollY(),r=e/2,s=i+n/2,d=t.getBoundingClientRect(),c=d.left+o+(t.width||t.offsetWidth)/2,a=d.top+i+(t.height||t.offsetHeight)/2,l=Math.round(r-c),h=Math.round(s-a);return"translate("+l+"px, "+h+"px) translateZ(0)"},t.scaleToViewport=function(t,e,n){var o,i=u.viewportWidth(),r=u.viewportHeight(),s=i/r,d=e/t,c=e/n;return o=e<i&&n<r?d:c<s?r/n*d:i/e*d,"scale("+o+")"},t}(),m=function(){function t(t,e){var n=this;this.openedListener=function(){h.removeTransitionEndListener(n._element,n.openedListener),n._overlay.state="open"},this.closedListener=function(){h.removeTransitionEndListener(n._element,n.closedListener),n._overlay.state="hidden",n._element.setAttribute(i,r),n.zoomedOut()},this._fullSrc=t.getAttribute(d)||t.currentSrc||t.src,this._element=t,this._overlay=e}return t.prototype.open=function(t){this._overlay.state="loading",this.zoomedIn(t),this._element.src=this._fullSrc,h.addTransitionEndListener(this._element,this.openedListener)},t.prototype.close=function(){this._overlay.state="closing",h.removeTransform(this._element),h.addTransitionEndListener(this._element,this.closedListener)},t.prototype.loaded=function(t,e){this._overlay.state="opening",this._element.setAttribute(i,s);var n=h.translateToCenter(this._element),o=h.scaleToViewport(this.width(),t,e);h.repaint(this._element),h.transform(this._element,n+" "+o)},t}(),f=function(t){function n(e,n){t.call(this,e,n),this._image=e}return e(n,t),n.prototype.zoomedIn=function(t){var e=this,n=document.createElement("img");n.onload=function(){e.loaded(n.width,n.height),e._image.removeAttribute(d),t()},n.src=this._fullSrc},n.prototype.zoomedOut=function(){},n.prototype.width=function(){return this._image.width},n}(m),p=function(t){function n(e,n){t.call(this,e,n),this._video=e}return e(n,t),n.prototype.zoomedIn=function(t){var e=this,n=document.createElement("video"),o=document.createElement("source");n.appendChild(o),n.addEventListener("canplay",function(){e.loaded(n.videoWidth,n.videoHeight),e._video.play(),t()}),o.src=this._fullSrc},n.prototype.zoomedOut=function(){this._video.getAttribute(c)===a&&this._video.play()},n.prototype.width=function(){return this._video.width||this._video.videoWidth},n}(m),v=27,y=70,_=30,w=function(){function t(){var t=this;this._overlay=new o,this.scrollListener=function(){Math.abs(t._initialScrollY-u.scrollY())>y&&t.close()},this.keyboardListener=function(e){e.keyCode===v&&t.close()},this.touchStartListener=function(e){t._initialTouchY=e.touches[0].pageY,e.target.addEventListener("touchmove",t.touchMoveListener)},this.touchMoveListener=function(e){Math.abs(e.touches[0].pageY-t._initialTouchY)>_&&(t.close(),e.target.removeEventListener("touchmove",t.touchMoveListener))}}return t.ready=function(t){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t()}):t()},t.prototype.listen=function(){var e=this;t.ready(function(){document.body.addEventListener("click",function(t){var n=t.target,o=n.getAttribute(i);o===r?e.zoom(t):o===s&&e.close()}),e._overlay.add()})},t.prototype.zoom=function(t){var e=this;if(t.stopPropagation(),"hidden"===this._overlay.state){var n=t.target;if(t.metaKey||t.ctrlKey){var o=n.getAttribute(d)||n.currentSrc||n.src;return void window.open(o,"_blank")}n.width>=window.innerWidth||("IMG"===n.tagName||"PICTURE"===n.tagName?this._current=new f(n,this._overlay):this._current=new p(n,this._overlay),this._current.open(function(){e.addCloseListeners(),e._initialScrollY=u.scrollY()}))}},t.prototype.close=function(){this._current&&(this._current.close(),this.removeCloseListeners(),this._current=void 0)},t.prototype.addCloseListeners=function(){window.addEventListener("scroll",this.scrollListener),document.addEventListener("keyup",this.keyboardListener),document.addEventListener("touchstart",this.touchStartListener)},t.prototype.removeCloseListeners=function(){window.removeEventListener("scroll",this.scrollListener),document.removeEventListener("keyup",this.keyboardListener),document.removeEventListener("touchstart",this.touchStartListener)},t}();t.Zoom=w,Object.defineProperty(t,"__esModule",{value:!0})});