/*!
 * zoom.ts v2.1.1
 * https://michael-bull.com/projects/zoom.ts
 * 
 * Copyright (c) 2016 Michael Bull (https://michael-bull.com)
 * Copyright (c) 2013 @fat
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.zoom=t.zoom||{})}(this,function(t){"use strict";function e(t,e){function n(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var n="data-zoom",o="zoom-in",i="zoom-out",r="data-zoom-src",s="data-zoom-play",d="always",c="zoom-overlay",a="zoom-overlay-open",u="zoom-overlay-loading",l="zoom-overlay-transitioning",m="zoom-wrap",h=function(){function t(){}return t.scrollX=function(){return void 0===window.pageXOffset?(document.documentElement||document.body).scrollLeft:window.pageXOffset},t.scrollY=function(){return void 0===window.pageYOffset?(document.documentElement||document.body).scrollTop:window.pageYOffset},t.viewportWidth=function(){return void 0===window.innerWidth?(document.documentElement||document.body).clientWidth:window.innerWidth},t.viewportHeight=function(){return void 0===window.innerHeight?(document.documentElement||document.body).clientHeight:window.innerHeight},t}(),p=function(){function t(){}return t.transform=function(t,e){t.style.webkitTransform=e,t.style.transform=e},t}(),f=document.createElement("div");f.className=m;var v=function(){function t(e){var i=this;this.openedListener=function(){t.removeTransitionEndListener(i._element,i.openedListener),document.body.classList.remove(l)},this.closedListener=function(){t.removeTransitionEndListener(i._element,i.closedListener),f.parentNode&&(i._element.setAttribute(n,o),f.parentNode.replaceChild(i._element,f),document.body.classList.remove(l),i.zoomedOut())},this._fullSrc=e.getAttribute(r)||e.currentSrc||e.src,this._element=e}return t.addTransitionEndListener=function(t,e){"transition"in document.body.style?(t.addEventListener("transitionend",e),t.addEventListener("webkitTransitionEnd",e)):e(void 0)},t.removeTransitionEndListener=function(t,e){t.removeEventListener("transitionend",e),t.removeEventListener("webkitTransitionEnd",e)},t.prototype.open=function(){document.body.classList.add(u),this.zoomedIn(),this._element.src=this._fullSrc,t.addTransitionEndListener(this._element,this.openedListener)},t.prototype.close=function(){var e=document.body.classList;e.remove(a),e.add(l),p.transform(this._element,""),p.transform(f,""),t.addTransitionEndListener(this._element,this.closedListener)},t.prototype.loaded=function(t,e){var o=document.body.classList;o.remove(u),o.add(l),o.add(a),this._element.parentNode.insertBefore(f,this._element),f.appendChild(this._element),this._element.setAttribute(n,i),this.scaleElement(t,e),this.translateWrap()},t.prototype.repaint=function(){this._element.offsetWidth},t.prototype.scaleElement=function(t,e){this.repaint();var n,o=h.viewportWidth(),i=h.viewportHeight(),r=o/i,s=t/this.width(),d=t/e;n=t<o&&e<i?s:d<r?i/e*s:o/t*s,p.transform(this._element,"scale("+n+")")},t.prototype.translateWrap=function(){this.repaint();var t=h.scrollX(),e=h.scrollY(),n=h.viewportWidth(),o=h.viewportHeight(),i=n/2,r=e+o/2,s=this._element,d=s.getBoundingClientRect(),c=d.left+t+(s.width||s.offsetWidth)/2,a=d.top+e+(s.height||s.offsetHeight)/2,u=Math.round(i-c),l=Math.round(r-a);p.transform(f,"translate("+u+"px, "+l+"px) translateZ(0)")},t}(),y=function(t){function n(e){t.call(this,e),this._image=e}return e(n,t),n.prototype.zoomedIn=function(){var t=this,e=document.createElement("img");e.onload=function(){t.loaded(e.width,e.height),t._image.removeAttribute(r)},e.src=this._fullSrc},n.prototype.zoomedOut=function(){},n.prototype.width=function(){return this._image.width},n}(v),L=function(t){function n(e){t.call(this,e),this._video=e}return e(n,t),n.prototype.zoomedIn=function(){var t=this,e=document.createElement("video"),n=document.createElement("source");e.appendChild(n),e.addEventListener("canplay",function(){t.loaded(e.videoWidth,e.videoHeight),t._video.play()}),n.src=this._fullSrc},n.prototype.zoomedOut=function(){this._video.getAttribute(s)===d&&this._video.play()},n.prototype.width=function(){return this._video.width||this._video.videoWidth},n}(v),w=27,_=70,g=30,E=document.createElement("div");E.className=c;var b=function(){function t(){var t=this;this.scrollListener=function(){Math.abs(t._initialScrollY-h.scrollY())>_&&t.close()},this.keyboardListener=function(e){e.keyCode===w&&t.close()},this.touchStartListener=function(e){t._initialTouchY=e.touches[0].pageY,e.target.addEventListener("touchmove",t.touchMoveListener)},this.touchMoveListener=function(e){Math.abs(e.touches[0].pageY-t._initialTouchY)>g&&(t.close(),e.target.removeEventListener("touchmove",t.touchMoveListener))}}return t.ready=function(t){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){t()}):t()},t.prototype.listen=function(){var e=this;t.ready(function(){document.body.addEventListener("click",function(t){var r=t.target;r.getAttribute(n)===o?e.zoom(t):r.getAttribute(n)===i&&e.close()}),document.body.appendChild(E)})},t.prototype.zoom=function(t){t.stopPropagation();var e=document.body.classList;if(!e.contains(a)&&!e.contains(u)){var n=t.target;if(t.metaKey||t.ctrlKey){var o=n.getAttribute(r)||n.currentSrc||n.src;return void window.open(o,"_blank")}n.width>=window.innerWidth||("IMG"===n.tagName||"PICTURE"===n.tagName?this._current=new y(n):this._current=new L(n),this._current.open(),this.addCloseListeners(),this._initialScrollY=h.scrollY())}},t.prototype.close=function(){this._current&&(this._current.close(),this.removeCloseListeners(),this._current=void 0)},t.prototype.addCloseListeners=function(){window.addEventListener("scroll",this.scrollListener),document.addEventListener("keyup",this.keyboardListener),document.addEventListener("touchstart",this.touchStartListener)},t.prototype.removeCloseListeners=function(){window.removeEventListener("scroll",this.scrollListener),document.removeEventListener("keyup",this.keyboardListener),document.removeEventListener("touchstart",this.touchStartListener)},t}();t.Zoom=b,Object.defineProperty(t,"__esModule",{value:!0})});