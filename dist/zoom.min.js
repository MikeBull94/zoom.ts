!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.zoom={})}(this,function(e){"use strict";function t(e){e.offsetHeight}function n(e,t){var n=e.getAttribute("data-"+t);if(null===n)return 1/0;var i=Number(n);return isNaN(i)?1/0:i}function i(e){var t=e.getAttribute("data-src");return null===t?e.src:t}var o=function(){function e(e,t){this.x=e,this.y=t}return e.fromPosition=function(t){return new e(t.left,t.top)},e.fromSize=function(t){return new e(t.width,t.height)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t,this.y*t)},e.prototype.divide=function(t){return new e(this.x/t,this.y/t)},e.prototype.scale=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.shrink=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.minDivisor=function(e){var t=this.shrink(e);return Math.min(t.x,t.y)},e.min=function(t,n){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y))},e.halfMidpoint=function(e,t){return t.subtract(e).divide(2)},e.fromTargetSize=function(t){return new e(n(t,"width"),n(t,"height"))},e.fromClientSize=function(t){return new e(t.clientWidth,t.clientHeight)},e}(),s="CSS1Compat";function r(e){return void 0===e&&(e=document),e.compatMode===s}function a(e){return void 0===e&&(e=document),r(e)?e.documentElement:e.body}function d(e){return void 0===e&&(e=document),o.fromClientSize(a(e))}function c(e,t){if(void 0===t&&(t=document),"loading"===t.readyState){var n=function(){t.removeEventListener("DOMContentLoaded",n),e.call(t)};t.addEventListener("DOMContentLoaded",n)}else e.call(t)}var l=["Webkit","Moz","ms","O"];function p(e){var t=""+e.charAt(0).toUpperCase()+e.substr(1),n=l.map(function(e){return""+e+t});return[e].concat(n)}function h(e,t){for(var n=0,i=p(t);n<i.length;n++){var o=i[n];if(o in e)return o}}function u(e){return e+"px"}function m(e){var t=e.x,n=e.y;return"translate("+u(t)+", "+u(n)+")"}function f(e){var t=e.x,n=e.y;return"translate3d("+u(t)+", "+u(n)+", 0)"}function v(e){return"scale("+e+")"}function L(e){return"scale3d("+e+", "+e+", 1)"}function y(e){return void 0!==h(e,"perspective")&&(!("WebkitPerspective"in e)||function(){var e=document.createElement("div");e.id=S,e.style.position="absolute";var t=document.createElement("style");t.textContent=C;var n=document.body;n.appendChild(t),n.appendChild(e);var i=e.offsetWidth,o=e.offsetHeight;return n.removeChild(t),n.removeChild(e),i===E&&o===g}())}var S="test3d",E=4,g=8,C="#"+S+"{margin:0;padding:0;border:0;width:0;height:0}@media (transform-3d),(-webkit-transform-3d){#"+S+"{width:"+u(E)+";height:"+u(g)+"}}";function w(e,t){e[t]=""}function A(e,t,n,i,o){e.left=t,e.top=n,e.width=i,e.maxWidth=i,e.height=o}function _(e,t){var n=e.getPropertyValue("padding-"+t),i=parseFloat(n);return isNaN(i)?0:i}var z={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function T(e,n,i){var o=e.style;o[n]="initial",i(),t(e),w(o,n)}var x=function(){function e(e,t,n,i,o,s){this.hasTransform=e,this.hasTransform3d=t,this.hasTransitions=n,this.transformProperty=i,this.transitionProperty=o,this.transitionEndEvent=s}return e.of=function(t){var n,i=h(t,"transform"),o=h(t,"transition"),s=!1;void 0!==i&&(s=!0);var r=!1;void 0!==o&&(r=void 0!==(n=z[o]));var a=!1;return void 0!==i&&(a=y(document.body.style)),new e(s,a,r,i,o,n)},e}(),I={scrollDismissPx:50},D=function(){function e(e,t){this.position=e,this.size=t}return e.of=function(t){var n=t.getBoundingClientRect();return new e(o.fromPosition(n),o.fromSize(n))},e.centreOffset=function(e,t){return o.halfMidpoint(t.size,e).subtract(t.position)},e.centreTranslation=function(t,n,i){var s=n.size.multiply(i),r=n.position.add(o.halfMidpoint(s,n.size));return this.centreOffset(t,new e(r,s)).divide(i)},e.centreOf=function(t,n,i){var s=d(t),r=o.min(s,n).minDivisor(i.size),a=i.size.multiply(r);return new e(this.centreOffset(s,new e(i.position,a)),a)},e.prototype.applyTo=function(e){A(e,u(this.position.x),u(this.position.y),u(this.size.x),u(this.size.y))},e}(),b=function(){function e(e,t){this.scale=e,this.translation=t}return e.centreOf=function(t,n){var i=d(),s=o.min(i,t).minDivisor(n.size);return new e(s,D.centreTranslation(i,n,s))},e.prototype.toString2d=function(){return v(this.scale)+" "+m(this.translation)},e.prototype.toString3d=function(){return L(this.scale)+" "+f(this.translation)},e}(),P=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.clone=function(){return this.element.children.item(1)},e.prototype.setBounds=function(e){e.applyTo(this.element.style)},e.prototype.resetBounds=function(){A(this.element.style,"","","","")},e.prototype.resetStyle=function(e){w(this.element.style,e)},e.prototype.fillViewport=function(e,t,n){var i=b.centreOf(t,n),o=e.transformProperty,s=this.element.style;e.hasTransform3d?s[o]=i.toString3d():s[o]=i.toString2d()},e.CLASS="zoom__container",e}(),N=function(){function e(e){this.element=e}return e.prototype.bounds=function(){return D.of(this.element)},e.prototype.hide=function(){this.element.classList.add(e.HIDDEN_CLASS)},e.prototype.show=function(){this.element.classList.remove(e.HIDDEN_CLASS)},e.prototype.isHidden=function(){return this.element.classList.contains(e.HIDDEN_CLASS)},e.prototype.activate=function(){this.element.classList.add(e.ACTIVE_CLASS)},e.prototype.deactivate=function(){this.element.classList.remove(e.ACTIVE_CLASS)},e.prototype.targetSize=function(){return o.fromTargetSize(this.element)},e.prototype.clearFixedSizes=function(){this.element.removeAttribute("width"),this.element.removeAttribute("height")},e.CLASS="zoom__image",e.HIDDEN_CLASS="zoom__image--hidden",e.ACTIVE_CLASS="zoom__image--active",e}(),O=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.startExpanding=function(){this.element.classList.add(e.EXPANDING_CLASS)},e.prototype.isExpanding=function(){return this.element.classList.contains(e.EXPANDING_CLASS)},e.prototype.finishExpanding=function(){this.element.classList.remove(e.EXPANDING_CLASS)},e.prototype.startCollapsing=function(){this.element.classList.add(e.COLLAPSING_CLASS)},e.prototype.isCollapsing=function(){return this.element.classList.contains(e.COLLAPSING_CLASS)},e.prototype.finishCollapsing=function(){this.element.classList.remove(e.COLLAPSING_CLASS),w(this.element.style,"height")},e.prototype.isTransitioning=function(){return this.isExpanding()||this.isCollapsing()},e.prototype.collapsed=function(){this.element.classList.remove(e.EXPANDED_CLASS)},e.prototype.expanded=function(){this.element.classList.add(e.EXPANDED_CLASS)},e.prototype.isExpanded=function(){return this.element.classList.contains(e.EXPANDED_CLASS)},e.prototype.position=function(){var e=this.element.getBoundingClientRect(),t=getComputedStyle(this.element),n=_(t,"top"),i=_(t,"left");return new o(e.left+i,e.top+n)},e.CLASS="zoom",e.EXPANDING_CLASS="zoom--expanding",e.EXPANDED_CLASS="zoom--expanded",e.COLLAPSING_CLASS="zoom--collapsing",e}(),k=function(){function e(e,t,n){this.element=e,this.eventType=t,this.token=n}return e.prototype.handleEvent=function(e){this.element.removeEventListener(this.eventType,this),this.element.classList.add(this.token)},e}(),W=function(){function e(e){this.element=e}return e.create=function(t){var n=document.createElement("img");return n.className=e.CLASS,n.src=t,n.addEventListener("load",new k(n,"load",e.LOADED_CLASS)),new e(n)},e.prototype.show=function(){this.element.classList.add(e.VISIBLE_CLASS)},e.prototype.hide=function(){this.element.classList.remove(e.VISIBLE_CLASS)},e.prototype.isVisible=function(){return this.element.classList.contains(e.VISIBLE_CLASS)},e.prototype.isHidden=function(){return!this.isVisible()},e.prototype.loaded=function(){this.element.classList.add(e.LOADED_CLASS)},e.prototype.isLoaded=function(){return this.element.classList.contains(e.LOADED_CLASS)},e.prototype.isLoading=function(){return!this.isLoaded()},e.CLASS="zoom__clone",e.VISIBLE_CLASS="zoom__clone--visible",e.LOADED_CLASS="zoom__clone--loaded",e}(),V=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.appendTo=function(e){e.appendChild(this.element),t(this.element),this.show()},e.prototype.removeFrom=function(e){e.removeChild(this.element)},e.prototype.show=function(){this.element.classList.add(e.VISIBLE_CLASS)},e.prototype.hide=function(){this.element.classList.remove(e.VISIBLE_CLASS)},e.CLASS="zoom__overlay",e.VISIBLE_CLASS="zoom__overlay--visible",e}(),B=function(){function e(e,t,n,i,o){this.overlay=e,this.wrapper=t,this.container=n,this.image=i,this.clone=o}return e.useExisting=function(t,n,o){var s=V.create(),r=new P(n),a=new O(o),d=new N(t);return i(t)===t.src?new e(s,a,r,d):new e(s,a,r,d,new W(r.clone()))},e.create=function(t){var n=V.create(),o=P.create(),s=O.create(),r=new N(t),a=i(t);return a===t.src?new e(n,s,o,r):new e(n,s,o,r,W.create(a))},e.prototype.appendContainerToWrapper=function(){this.wrapper.element.appendChild(this.container.element)},e.prototype.replaceImageWithWrapper=function(){this.image.element.parentElement.replaceChild(this.wrapper.element,this.image.element)},e.prototype.appendImageToContainer=function(){this.container.element.appendChild(this.image.element)},e.prototype.appendCloneToContainer=function(){void 0!==this.clone&&this.container.element.appendChild(this.clone.element)},e.prototype.replaceImageWithClone=function(){void 0!==this.clone&&(this.clone.show(),this.image.hide())},e.prototype.replaceCloneWithImage=function(){void 0!==this.clone&&(this.image.show(),this.clone.hide())},e.prototype.fixWrapperHeight=function(){this.wrapper.element.style.height=u(this.image.element.height)},e.prototype.collapse=function(){this.replaceCloneWithImage(),this.overlay.removeFrom(document.body),this.image.deactivate(),this.wrapper.finishCollapsing()},e.prototype.showCloneIfLoaded=function(){void 0!==this.clone&&this.clone.isLoaded()&&this.clone.isHidden()&&this.replaceImageWithClone()},e}(),M=function(){function e(e){this.callback=e}return e.prototype.handleEvent=function(e){var t=e.target;if(t instanceof HTMLImageElement&&t.classList.contains(N.CLASS))if(e.metaKey||e.ctrlKey)e.preventDefault(),e.stopPropagation(),window.open(i(t),"_blank");else if(null!==t.parentElement&&null!==t.parentElement.parentElement){var n,o=t.parentElement,s=t.parentElement.parentElement;if(o.classList.contains(P.CLASS)&&s.classList.contains(O.CLASS))(n=B.useExisting(t,o,s)).wrapper.isTransitioning()||n.wrapper.isExpanded()||(e.preventDefault(),e.stopPropagation(),this.callback(n));else(n=B.create(t)).appendContainerToWrapper(),n.replaceImageWithWrapper(),n.appendImageToContainer(),n.appendCloneToContainer(),e.preventDefault(),e.stopPropagation(),this.callback(n)}},e}();function H(e){return void 0===e&&(e=window),void 0===e.pageYOffset?a().scrollTop:e.pageYOffset}var F=function(){function e(e,t){this.eventType=e,this.dom=t}return e.prototype.handleEvent=function(e){this.dom.container.element.removeEventListener(this.eventType,this),this.dom.collapse()},e}();function G(e,t,n){"function"==typeof t?t.call(e,n):t.handleEvent(n)}function X(e,t,n){e.removeEventListener(t,n)}var K=function(){function e(e){this.delegate=e}return e.prototype.handleEvent=function(e){27===e.keyCode&&G(document,this.delegate,e)},e}(),R=function(){function e(e,t,n,i){this.dom=e,this.targetSize=n,this.resizedListener=i,this.transitionEnd=t.transitionEndEvent,this.transitionProperty=t.transitionProperty,this.transformProperty=t.transformProperty}return e.prototype.handleEvent=function(e){var t=this;this.dom.container.element.removeEventListener(this.transitionEnd,this),this.dom.showCloneIfLoaded(),this.dom.wrapper.finishExpanding(),this.dom.wrapper.expanded();var n=this.dom.container;T(n.element,this.transitionProperty,function(){n.resetStyle(t.transformProperty),n.setBounds(D.centreOf(document,t.targetSize,t.resizedListener.bounds))})},e}(),Y=function(){function e(e,t,n){this.dom=e,this.features=t,this.targetSize=n,this._bounds=e.image.bounds()}return e.prototype.handleEvent=function(e){var t=this.dom.wrapper,n=this.dom.container;this._bounds=new D(t.position(),this._bounds.size),t.isTransitioning()?n.fillViewport(this.features,this.targetSize,this._bounds):n.setBounds(D.centreOf(document,this.targetSize,this._bounds))},Object.defineProperty(e.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0}),e}(),j=function(){function e(e,t,n){this.start=e,this.distance=t,this.delegate=n}return e.prototype.handleEvent=function(e){Math.abs(this.start-H())>this.distance&&G(document,this.delegate,e)},e}(),U=function(){function e(e){this.dom=e}return e.prototype.handleEvent=function(e){var t=this.dom.clone;if(void 0!==t){t.element.removeEventListener("load",this);var n=this.dom.wrapper;t.isHidden()&&n.isExpanded()&&this.dom.replaceImageWithClone()}},e}(),Z=function(){function e(e,t,n){void 0===n&&(n=I);var i=this;this.collapseInstantlyListener=function(e){e.preventDefault(),e.stopPropagation(),i.collapseInstantly()},this.collapseTransitionListener=function(e){var t=i.features.transitionEndEvent,n=i.features.transitionProperty,o=i.features.transformProperty;e.preventDefault(),e.stopPropagation(),i.removeEventListeners(),i.dom.overlay.hide(),i.dom.wrapper.startCollapsing(),i.collapseListener=new F(t,i.dom),i.dom.container.element.addEventListener(t,i.collapseListener),i.dom.wrapper.isExpanding()?(i.dom.container.resetStyle(o),i.dom.wrapper.finishExpanding()):(T(i.dom.container.element,n,function(){void 0!==i.resizeListener&&i.dom.container.fillViewport(i.features,i.targetSize,i.resizeListener.bounds)}),i.dom.container.resetStyle(o),i.dom.container.resetBounds(),i.dom.wrapper.collapsed())},this.dom=e,this.features=t,this.config=n,this.transition=t.hasTransform&&t.hasTransitions,this.targetSize=this.dom.image.targetSize(),this.dismissListener=this.transition?this.collapseTransitionListener:this.collapseInstantlyListener,this.resizeListener=new Y(this.dom,this.features,this.targetSize),this.scrollListener=new j(H(),this.config.scrollDismissPx,this.dismissListener),this.escKeyListener=new K(this.dismissListener)}return e.prototype.expand=function(){void 0!==this.dom.clone&&(this.dom.clone.isLoaded()?this.dom.replaceImageWithClone():(this.showCloneListener=new U(this.dom),this.dom.clone.element.addEventListener("load",this.showCloneListener))),this.transition?this.expandTransition():this.expandInstantly()},e.prototype.destroy=function(){this.removeEventListeners(),(this.dom.wrapper.isTransitioning()||this.dom.wrapper.isExpanded())&&this.collapseInstantly()},e.prototype.removeEventListeners=function(){if(X(this.dom.container.element,"click",this.dismissListener),X(window,"resize",this.resizeListener),X(window,"scroll",this.scrollListener),X(document,"keyup",this.escKeyListener),void 0!==this.dom.clone&&void 0!==this.showCloneListener&&this.dom.clone.element.removeEventListener("load",this.showCloneListener),this.transition){var e=this.features.transitionEndEvent;X(this.dom.container.element,e,this.expandListener),X(this.dom.container.element,e,this.collapseListener)}},e.prototype.expandInstantly=function(){this.dom.container.element.addEventListener("click",this.dismissListener),window.addEventListener("resize",this.resizeListener),window.addEventListener("scroll",this.scrollListener),document.addEventListener("keyup",this.escKeyListener),this.dom.overlay.appendTo(document.body),this.dom.showCloneIfLoaded(),this.dom.wrapper.expanded(),this.dom.fixWrapperHeight(),this.dom.image.activate(),this.dom.image.clearFixedSizes(),this.dom.container.setBounds(D.centreOf(document,this.targetSize,this.resizeListener.bounds))},e.prototype.collapseInstantly=function(){this.removeEventListeners(),this.dom.container.resetBounds(),this.dom.wrapper.collapsed(),this.dom.collapse()},e.prototype.expandTransition=function(){var e=this.features.transitionEndEvent;this.expandListener=new R(this.dom,this.features,this.targetSize,this.resizeListener),this.dom.container.element.addEventListener("click",this.dismissListener),window.addEventListener("resize",this.resizeListener),window.addEventListener("scroll",this.scrollListener),document.addEventListener("keyup",this.escKeyListener),this.dom.container.element.addEventListener(e,this.expandListener),this.dom.overlay.appendTo(document.body),this.dom.wrapper.startExpanding(),this.dom.fixWrapperHeight(),this.dom.image.activate(),this.dom.image.clearFixedSizes(),this.dom.container.fillViewport(this.features,this.targetSize,this.resizeListener.bounds)},e}();e.listen=function(e){void 0===e&&(e=I),c(function(){var t=document.body,n=x.of(t.style);t.addEventListener("click",new M(function(t){new Z(t,n,e).expand()}))})},e.DEFAULT_CONFIG=I,e.ZoomInstance=Z,e.QUIRKS_MODE="BackCompat",e.STANDARDS_MODE=s,e.isStandardsMode=r,e.rootElement=a,e.viewportSize=d,e.ready=c,e.Features=x,e.VENDOR_PREFIXES=l,e.vendorProperties=p,e.vendorProperty=h,e.pageScrollY=H,e.Clone=W,e.Container=P,e.Image=N,e.Overlay=V,e.Wrapper=O,e.ZoomDOM=B,e.repaint=t,e.targetDimension=n,e.fullSrc=i,e.ScaleAndTranslate=b,e.resetStyle=w,e.setBounds=A,e.parsePadding=_,e.translate=m,e.translate3d=f,e.scale=v,e.scale3d=L,e.supports3dTransformations=y,e.TEST3D_ID=S,e.TEST3D_WIDTH=E,e.TEST3D_HEIGHT=g,e.TEST3D_STYLE=C,e.TRANSITION_END_EVENTS=z,e.ignoreTransitions=T,e.AddClassListener=k,e.ClickZoomableListener=M,e.CollapseListener=F,e.EscKeyListener=K,e.ExpandListener=R,e.ResizeListener=Y,e.ScrollListener=j,e.ShowCloneListener=U,e.fireEventListener=G,e.removeEventListener=X,e.Bounds=D,e.pixels=u,e.Vector2=o,Object.defineProperty(e,"__esModule",{value:!0})});
