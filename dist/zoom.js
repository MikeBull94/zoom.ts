!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.zoom={})}(this,function(e){"use strict";function t(e){e.offsetHeight}function n(e,t){var n=e.getAttribute("data-"+t);if(null===n)return 1/0;var i=Number(n);return isNaN(i)?1/0:i}function i(e){var t=e.getAttribute("data-src");return null===t?e.src:t}var o=function(){function e(e,t){this.x=e,this.y=t}return e.fromPosition=function(t){return new e(t.left,t.top)},e.fromSize=function(t){return new e(t.width,t.height)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t,this.y*t)},e.prototype.divide=function(t){return new e(this.x/t,this.y/t)},e.prototype.scale=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.shrink=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.minDivisor=function(e){var t=this.shrink(e);return Math.min(t.x,t.y)},e.min=function(t,n){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y))},e.halfMidpoint=function(e,t){return t.subtract(e).divide(2)},e.fromTargetSize=function(t){return new e(n(t,"width"),n(t,"height"))},e.fromClientSize=function(t){return new e(t.clientWidth,t.clientHeight)},e}(),r="CSS1Compat";function s(e){return e.compatMode===r}function a(e){return s(e)?e.documentElement:e.body}function c(e){return o.fromClientSize(a(e))}function l(e,t){if("loading"===e.readyState){var n=function(){e.removeEventListener("DOMContentLoaded",n),t.call(e)};e.addEventListener("DOMContentLoaded",n)}else t.call(e)}var d=["Webkit","Moz","ms","O"];function p(e){var t=""+e.charAt(0).toUpperCase()+e.substr(1),n=d.map(function(e){return""+e+t});return[e].concat(n)}function u(e,t){for(var n=0,i=p(t);n<i.length;n++){var o=i[n];if(o in e)return o}}function h(e){return e+"px"}function f(e){return"translate("+e.x+"px, "+e.y+"px)"}function m(e){return"translate3d("+e.x+"px, "+e.y+"px, 0)"}function v(e){return"scale("+e+")"}function L(e){return"scale3d("+e+", "+e+", 1)"}function y(e){return void 0!==u(e,"perspective")&&(!("WebkitPerspective"in e)||function(){var e=document.createElement("div");e.id=S,e.style.position="absolute";var t=document.createElement("style");t.textContent=C;var n=document.body;n.appendChild(t),n.appendChild(e);var i=e.offsetWidth,o=e.offsetHeight;return n.removeChild(t),n.removeChild(e),i===g&&o===E}())}var S="test3d",g=4,E=8,C="#"+S+"{margin:0;padding:0;border:0;width:0;height:0}@media (transform-3d),(-webkit-transform-3d){#"+S+"{width:"+h(g)+";height:"+h(E)+"}}";function w(e,t){e[t]=""}function A(e,t,n,i,o){e.left=t,e.top=n,e.width=i,e.maxWidth=i,e.height=o}function _(e,t){var n=e.getPropertyValue("padding-"+t),i=parseFloat(n);return isNaN(i)?0:i}var T={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function x(e,n,i){var o=e.style;o[n]="initial",i(),t(e),w(o,n)}var D=function(){function e(e,t,n,i,o,r){this.hasTransform=e,this.hasTransform3d=t,this.hasTransitions=n,this.transformProperty=i,this.transitionProperty=o,this.transitionEndEvent=r}return e.of=function(t){var n,i=u(t,"transform"),o=u(t,"transition"),r=!1;void 0!==i&&(r=!0);var s=!1;void 0!==o&&(s=void 0!==(n=T[o]));var a=!1;return void 0!==i&&(a=y(document.body.style)),new e(r,a,s,i,o,n)},e}(),I={scrollDismissPx:50},z=function(){function e(e,t){this.position=e,this.size=t}return e.of=function(t){var n=t.getBoundingClientRect();return new e(o.fromPosition(n),o.fromSize(n))},e.centreOffset=function(e,t){return o.halfMidpoint(t.size,e).subtract(t.position)},e.centreTranslation=function(t,n,i){var r=n.size.multiply(i),s=n.position.add(o.halfMidpoint(r,n.size));return this.centreOffset(t,new e(s,r)).divide(i)},e.centreOf=function(t,n,i){var r=c(t),s=o.min(r,n).minDivisor(i.size),a=i.size.multiply(s);return new e(this.centreOffset(r,new e(i.position,a)),a)},e.prototype.applyTo=function(e){A(e,h(this.position.x),h(this.position.y),h(this.size.x),h(this.size.y))},e}(),b=function(){function e(e,t){this.scale=e,this.translation=t}return e.centreOf=function(t,n){var i=c(document),r=o.min(i,t).minDivisor(n.size);return new e(r,z.centreTranslation(i,n,r))},e.prototype.toString2d=function(){return v(this.scale)+" "+f(this.translation)},e.prototype.toString3d=function(){return L(this.scale)+" "+m(this.translation)},e}(),N=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.clone=function(){return this.element.children.item(1)},e.prototype.setBounds=function(e){e.applyTo(this.element.style)},e.prototype.resetBounds=function(){A(this.element.style,"","","","")},e.prototype.fillViewport=function(e,t,n){var i=b.centreOf(t,n),o=e.transformProperty,r=this.element.style;e.hasTransform3d?r[o]=i.toString3d():r[o]=i.toString2d()},e.prototype.resetStyle=function(e){w(this.element.style,e)},e.CLASS="zoom__container",e}(),O=function(){function e(e){this.element=e}return e.prototype.bounds=function(){return z.of(this.element)},e.prototype.hide=function(){this.element.classList.add(e.HIDDEN_CLASS)},e.prototype.show=function(){this.element.classList.remove(e.HIDDEN_CLASS)},e.prototype.isHidden=function(){return this.element.classList.contains(e.HIDDEN_CLASS)},e.prototype.activate=function(){this.element.classList.add(e.ACTIVE_CLASS)},e.prototype.deactivate=function(){this.element.classList.remove(e.ACTIVE_CLASS)},e.prototype.targetSize=function(){return o.fromTargetSize(this.element)},e.prototype.clearFixedSizes=function(){this.element.removeAttribute("width"),this.element.removeAttribute("height")},e.CLASS="zoom__image",e.HIDDEN_CLASS="zoom__image--hidden",e.ACTIVE_CLASS="zoom__image--active",e}(),P=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.startExpanding=function(){this.element.classList.add(e.EXPANDING_CLASS)},e.prototype.isExpanding=function(){return this.element.classList.contains(e.EXPANDING_CLASS)},e.prototype.finishExpanding=function(){this.element.classList.remove(e.EXPANDING_CLASS)},e.prototype.startCollapsing=function(){this.element.classList.add(e.COLLAPSING_CLASS)},e.prototype.isCollapsing=function(){return this.element.classList.contains(e.COLLAPSING_CLASS)},e.prototype.finishCollapsing=function(){this.element.classList.remove(e.COLLAPSING_CLASS),w(this.element.style,"height")},e.prototype.isTransitioning=function(){return this.isExpanding()||this.isCollapsing()},e.prototype.collapsed=function(){this.element.classList.remove(e.EXPANDED_CLASS)},e.prototype.expanded=function(){this.element.classList.add(e.EXPANDED_CLASS)},e.prototype.isExpanded=function(){return this.element.classList.contains(e.EXPANDED_CLASS)},e.prototype.position=function(){var e=this.element.getBoundingClientRect(),t=getComputedStyle(this.element),n=_(t,"top"),i=_(t,"left");return new o(e.left+i,e.top+n)},e.CLASS="zoom",e.EXPANDING_CLASS="zoom--expanding",e.EXPANDED_CLASS="zoom--expanded",e.COLLAPSING_CLASS="zoom--collapsing",e}(),W=function(){function e(e){this.element=e}return e.prototype.handleEvent=function(e){this.element.classList.add(M.LOADED_CLASS)},e}(),M=function(){function e(e){this.element=e}return e.create=function(t){var n=document.createElement("img");return n.className=e.CLASS,n.src=t,n.addEventListener("load",new W(n)),new e(n)},e.prototype.show=function(){this.element.classList.add(e.VISIBLE_CLASS)},e.prototype.hide=function(){this.element.classList.remove(e.VISIBLE_CLASS)},e.prototype.isVisible=function(){return this.element.classList.contains(e.VISIBLE_CLASS)},e.prototype.isHidden=function(){return!this.isVisible()},e.prototype.loaded=function(){this.element.classList.add(e.LOADED_CLASS)},e.prototype.isLoaded=function(){return this.element.classList.contains(e.LOADED_CLASS)},e.prototype.isLoading=function(){return!this.isLoaded()},e.CLASS="zoom__clone",e.VISIBLE_CLASS="zoom__clone--visible",e.LOADED_CLASS="zoom__clone--loaded",e}(),H=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.appendTo=function(e){e.appendChild(this.element),t(this.element),this.show()},e.prototype.removeFrom=function(e){e.removeChild(this.element)},e.prototype.show=function(){this.element.classList.add(e.VISIBLE_CLASS)},e.prototype.hide=function(){this.element.classList.remove(e.VISIBLE_CLASS)},e.CLASS="zoom__overlay",e.VISIBLE_CLASS="zoom__overlay--visible",e}(),V=function(){function e(e,t,n,i,o){this.overlay=e,this.wrapper=t,this.container=n,this.image=i,this.clone=o}return e.useExisting=function(t,n,o){var r=H.create(),s=new N(n),a=new P(o),c=new O(t);return i(t)===t.src?new e(r,a,s,c):new e(r,a,s,c,new M(s.clone()))},e.create=function(t){var n=H.create(),o=N.create(),r=P.create(),s=new O(t),a=i(t);return a===t.src?new e(n,r,o,s):new e(n,r,o,s,M.create(a))},e.prototype.appendContainerToWrapper=function(){this.wrapper.element.appendChild(this.container.element)},e.prototype.replaceImageWithWrapper=function(){this.image.element.parentElement.replaceChild(this.wrapper.element,this.image.element)},e.prototype.appendImageToContainer=function(){this.container.element.appendChild(this.image.element)},e.prototype.appendCloneToContainer=function(){void 0!==this.clone&&this.container.element.appendChild(this.clone.element)},e.prototype.replaceImageWithClone=function(){void 0!==this.clone&&(this.clone.show(),this.image.hide())},e.prototype.replaceCloneWithImage=function(){void 0!==this.clone&&(this.image.show(),this.clone.hide())},e.prototype.fixWrapperHeight=function(){this.wrapper.element.style.height=h(this.image.element.height)},e.prototype.createCloneLoadedListener=function(){var e=this;return function(){void 0!==e.clone&&e.clone.isHidden()&&e.wrapper.isExpanded()&&e.replaceImageWithClone()}},e.prototype.removeCloneLoadedListener=function(e){void 0!==this.clone&&void 0!==e&&this.clone.isLoading()&&this.clone.element.removeEventListener("load",e)},e.prototype.showCloneIfLoaded=function(){void 0!==this.clone&&this.clone.isLoaded()&&this.clone.isHidden()&&this.replaceImageWithClone()},e}();function B(e){return void 0===e&&(e=window),void 0===e.pageYOffset?a(e.document).scrollTop:e.pageYOffset}function k(e,t,n){"function"==typeof t?t.call(e,n):t.handleEvent(n)}var F=function(){function e(e,t){this.target=e,this.delegate=t}return e.prototype.handleEvent=function(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),k(this.target,this.delegate,e))},e}(),G=function(){function e(e,t,n,i){this.target=e,this.start=t,this.distance=n,this.delegate=i}return e.prototype.handleEvent=function(e){Math.abs(this.start-B())>this.distance&&k(this.target,this.delegate,e)},e}(),X=function(){function e(e,t,n){this.delegateListener=e,this.scrollListener=t,this.escKeyListener=n}return e.create=function(t,n){return new e(n,new G(document,B(),t,n),new F(document,n))},e.prototype.addTo=function(e,t){t.addEventListener("click",this.delegateListener),e.addEventListener("scroll",this.scrollListener),e.document.addEventListener("keyup",this.escKeyListener)},e.prototype.removeFrom=function(e,t){t.removeEventListener("click",this.delegateListener),e.removeEventListener("scroll",this.scrollListener),e.document.removeEventListener("keyup",this.escKeyListener)},e}(),R=function(){function e(e,t,n){this.dom=e,this.features=t,this.targetSize=n,this._bounds=e.image.bounds()}return e.prototype.handleEvent=function(e){var t=this.dom.wrapper,n=this.dom.container;this._bounds=new z(t.position(),this._bounds.size),t.isTransitioning()?n.fillViewport(this.features,this.targetSize,this._bounds):n.setBounds(z.centreOf(document,this.targetSize,this._bounds))},Object.defineProperty(e.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0}),e}(),K=function(){function e(e,t,n){void 0===n&&(n=I),this.target=e,this.features=t,this.config=n}return e.prototype.handleEvent=function(e){var t=e.target;if(t instanceof HTMLImageElement&&t.classList.contains(O.CLASS)){var n=t.parentElement;if(n instanceof HTMLElement){var o=n.parentElement;if(o instanceof HTMLElement){e.preventDefault(),e.stopPropagation();var r=!1;if(n.classList.contains(N.CLASS)&&o.classList.contains(P.CLASS)&&(r=!0),e.metaKey||e.ctrlKey)window.open(i(t),"_blank");else{this.target.removeEventListener("click",this);var s=void 0;r?s=V.useExisting(t,n,o):((s=V.create(t)).appendContainerToWrapper(),s.replaceImageWithWrapper(),s.appendImageToContainer(),s.appendCloneToContainer());var a=void 0;void 0!==s.clone&&(s.clone.isLoaded()?s.replaceImageWithClone():(a=s.createCloneLoadedListener(),s.clone.element.addEventListener("load",a)));var c=s.image.targetSize();this.features.hasTransform&&this.features.hasTransitions?this.zoomTransition(s,c,a):this.zoomInstant(s,c,a)}}}}},e.prototype.zoomInstant=function(e,t,n){var i=this,o=new R(e,this.features,t),r=X.create(this.config.scrollDismissPx,function(){r.removeFrom(window,e.container.element),window.removeEventListener("resize",o),e.removeCloneLoadedListener(n),e.wrapper.collapsed(),e.container.resetBounds(),i.collapsed(e)});e.overlay.appendTo(document.body),e.wrapper.expanded(),e.fixWrapperHeight(),e.image.activate(),e.image.clearFixedSizes(),e.container.setBounds(z.centreOf(document,t,o.bounds)),window.addEventListener("resize",o),r.addTo(window,e.container.element)},e.prototype.zoomTransition=function(e,t,n){var i=this,o=this.features.transitionEndEvent,r=this.features.transitionProperty,s=this.features.transformProperty,a=new R(e,this.features,t),c=function(){e.showCloneIfLoaded(),e.wrapper.finishExpanding(),e.wrapper.expanded(),x(e.container.element,r,function(){e.container.resetStyle(s),e.container.setBounds(z.centreOf(document,t,a.bounds))}),e.container.element.removeEventListener(o,c)},l=X.create(this.config.scrollDismissPx,function(){l.removeFrom(window,e.container.element),window.removeEventListener("resize",a),e.removeCloneLoadedListener(n),e.overlay.hide(),e.wrapper.startCollapsing();var d=function(){i.collapsed(e),e.container.element.removeEventListener(o,d)};e.container.element.addEventListener(o,d),e.wrapper.isExpanding()?(e.container.element.removeEventListener(o,c),e.container.resetStyle(s),e.wrapper.finishExpanding()):(x(e.container.element,r,function(){e.container.fillViewport(i.features,t,a.bounds)}),e.container.resetStyle(s),e.container.resetBounds(),e.wrapper.collapsed())});e.overlay.appendTo(document.body),e.wrapper.startExpanding(),e.fixWrapperHeight(),e.image.activate(),e.image.clearFixedSizes(),e.container.element.addEventListener(o,c),e.container.fillViewport(this.features,t,a.bounds),l.addTo(window,e.container.element),window.addEventListener("resize",a)},e.prototype.collapsed=function(e){var t=this;e.replaceCloneWithImage(),e.overlay.removeFrom(document.body),e.image.deactivate(),e.wrapper.finishCollapsing(),setTimeout(function(){t.target.addEventListener("click",t)},1)},e}();e.listen=function(e){void 0===e&&(e=I),l(document,function(){var t=document.body,n=D.of(t.style),i=new K(t,n,e);t.addEventListener("click",i)})},e.DEFAULT_CONFIG=I,e.QUIRKS_MODE="BackCompat",e.STANDARDS_MODE=r,e.isStandardsMode=s,e.rootElement=a,e.viewportSize=c,e.ready=l,e.Features=D,e.VENDOR_PREFIXES=d,e.vendorProperties=p,e.vendorProperty=u,e.pageScrollY=B,e.Clone=M,e.Container=N,e.Image=O,e.Overlay=H,e.Wrapper=P,e.ZoomDOM=V,e.repaint=t,e.targetDimension=n,e.fullSrc=i,e.ScaleAndTranslate=b,e.translate=f,e.translate3d=m,e.scale=v,e.scale3d=L,e.supports3dTransformations=y,e.TEST3D_ID=S,e.TEST3D_WIDTH=g,e.TEST3D_HEIGHT=E,e.TEST3D_STYLE=C,e.TRANSITION_END_EVENTS=T,e.ignoreTransitions=x,e.DismissListeners=X,e.EscKeyListener=F,e.fireEventListener=k,e.ZoomResizedListener=R,e.ScrollListener=G,e.ZoomListener=K,e.Bounds=z,e.pixels=h,e.Vector2=o,Object.defineProperty(e,"__esModule",{value:!0})});
