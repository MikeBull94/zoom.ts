!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.zoom={})}(this,function(e){"use strict";function t(e){e.offsetHeight}function n(e,t){var n=e.getAttribute("data-"+t);if(null===n)return 1/0;var i=Number(n);return isNaN(i)?1/0:i}function i(e,t){e[t]=""}function o(e,t,n,i,o){e.left=t,e.top=n,e.width=i,e.maxWidth=i,e.height=o}function r(e,t){var n=e.getPropertyValue("padding-"+t),i=parseFloat(n);return isNaN(i)?0:i}var s=function(){function e(e,t){this.x=e,this.y=t}return e.fromPosition=function(t){return new e(t.left,t.top)},e.fromSize=function(t){return new e(t.width,t.height)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t,this.y*t)},e.prototype.divide=function(t){return new e(this.x/t,this.y/t)},e.prototype.scale=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.shrink=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.minDivisor=function(e){var t=this.shrink(e);return Math.min(t.x,t.y)},e.min=function(t,n){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y))},e.halfMidpoint=function(e,t){return t.subtract(e).divide(2)},e.targetSizeOf=function(t){return new e(n(t,"width"),n(t,"height"))},e.clientSizeOf=function(t){return new e(t.clientWidth,t.clientHeight)},e}(),a="CSS1Compat";function c(e){return e.compatMode===a}function l(e){return c(e)?e.documentElement:e.body}function d(e){return s.clientSizeOf(l(e))}function u(e,t){if("loading"===e.readyState){var n=function(){e.removeEventListener("DOMContentLoaded",n),t.call(e)};e.addEventListener("DOMContentLoaded",n)}else t.call(e)}var p=["Webkit","Moz","ms","O"];function f(e){var t=""+e.charAt(0).toUpperCase()+e.substr(1),n=p.map(function(e){return""+e+t});return[e].concat(n)}function h(e,t){for(var n=0,i=f(t);n<i.length;n++){var o=i[n];if(o in e)return o}}function m(e){return e+"px"}function v(e){return"translate("+e.x+"px, "+e.y+"px)"}function L(e){return"translate3d("+e.x+"px, "+e.y+"px, 0)"}function y(e){return"scale("+e+")"}function S(e){return"scale3d("+e+", "+e+", 1)"}function g(e){return void 0!==h(e,"perspective")&&(!("WebkitPerspective"in e)||function(){var e=document.createElement("div");e.id=E,e.style.position="absolute";var t=document.createElement("style");t.textContent=A;var n=document.body;n.appendChild(t),n.appendChild(e);var i=e.offsetWidth,o=e.offsetHeight;return n.removeChild(t),n.removeChild(e),i===C&&o===w}())}var E="test3d",C=4,w=8,A="#"+E+"{margin:0;padding:0;border:0;width:0;height:0}@media (transform-3d),(-webkit-transform-3d){#"+E+"{width:"+m(C)+";height:"+m(w)+"}}";var _={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};function T(e,n,o){var r=e.style;r[n]="initial",o(),t(e),i(r,n)}var D=function(){function e(e,t,n,i,o,r){this.hasTransform=e,this.hasTransform3d=t,this.hasTransitions=n,this.transformProperty=i,this.transitionProperty=o,this.transitionEndEvent=r}return e.of=function(t){var n,i=h(t,"transform"),o=h(t,"transition"),r=!1;void 0!==i&&(r=!0);var s=!1;void 0!==o&&(s=void 0!==(n=_[o]));var a=!1;return void 0!==i&&(a=g(document.body.style)),new e(r,a,s,i,o,n)},e}(),I={scrollDismissPx:50},x=function(){function e(e,t){this.position=e,this.size=t}return e.of=function(t){var n=t.getBoundingClientRect();return new e(s.fromPosition(n),s.fromSize(n))},e.centreOffset=function(e,t){return s.halfMidpoint(t.size,e).subtract(t.position)},e.centreTranslation=function(t,n,i){var o=n.size.multiply(i),r=n.position.add(s.halfMidpoint(o,n.size));return this.centreOffset(t,new e(r,o)).divide(i)},e.centreOf=function(t,n,i){var o=d(t),r=s.min(o,n).minDivisor(i.size),a=i.size.multiply(r);return new e(this.centreOffset(o,new e(i.position,a)),a)},e.prototype.applyTo=function(e){o(e,m(this.position.x),m(this.position.y),m(this.size.x),m(this.size.y))},e}(),z=function(){function e(e,t){this.scale=e,this.translation=t}return e.centreOf=function(t,n){var i=d(document),o=s.min(i,t).minDivisor(n.size);return new e(o,x.centreTranslation(i,n,o))},e.prototype.toString2d=function(){return y(this.scale)+" "+v(this.translation)},e.prototype.toString3d=function(){return S(this.scale)+" "+L(this.translation)},e}(),b=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.parent=function(){return this.element.parentElement},e.prototype.clone=function(){return this.element.children.item(1)},e.prototype.setBounds=function(e){e.applyTo(this.element.style)},e.prototype.resetBounds=function(){o(this.element.style,"","","","")},e.prototype.fillViewport=function(e,t,n){var i=z.centreOf(t,n),o=e.transformProperty,r=this.element.style;e.hasTransform3d?r[o]=i.toString3d():r[o]=i.toString2d()},e.prototype.resetStyle=function(e){i(this.element.style,e)},e.CLASS="zoom__container",e}(),O=function(){function e(e){this.element=e}return e.prototype.bounds=function(){return x.of(this.element)},e.prototype.hide=function(){this.element.classList.add(e.HIDDEN_CLASS)},e.prototype.show=function(){this.element.classList.remove(e.HIDDEN_CLASS)},e.prototype.isHidden=function(){return this.element.classList.contains(e.HIDDEN_CLASS)},e.prototype.activate=function(){this.element.classList.add(e.ACTIVE_CLASS)},e.prototype.deactivate=function(){this.element.classList.remove(e.ACTIVE_CLASS)},e.CLASS="zoom__image",e.HIDDEN_CLASS="zoom__image--hidden",e.ACTIVE_CLASS="zoom__image--active",e}();function N(e,t){var n=e.getAttribute("data-src");return null===n?t.src:n}var P=function(){function e(e){this.element=e}return e.prototype.startExpanding=function(){this.element.classList.add(e.EXPANDING_CLASS)},e.prototype.isExpanding=function(){return this.element.classList.contains(e.EXPANDING_CLASS)},e.prototype.finishExpanding=function(){this.element.classList.remove(e.EXPANDING_CLASS)},e.prototype.startCollapsing=function(){this.element.classList.add(e.COLLAPSING_CLASS)},e.prototype.isCollapsing=function(){return this.element.classList.contains(e.COLLAPSING_CLASS)},e.prototype.finishCollapsing=function(){this.element.classList.remove(e.COLLAPSING_CLASS),i(this.element.style,"height")},e.prototype.isTransitioning=function(){return this.isExpanding()||this.isCollapsing()},e.prototype.collapsed=function(){this.element.classList.remove(e.EXPANDED_CLASS)},e.prototype.expanded=function(){this.element.classList.add(e.EXPANDED_CLASS)},e.prototype.isExpanded=function(){return this.element.classList.contains(e.EXPANDED_CLASS)},e.prototype.srcOf=function(e){var t=this.element.getAttribute("data-src");return null===t?e.src:t},e.prototype.position=function(){var e=this.element.getBoundingClientRect(),t=getComputedStyle(this.element),n=r(t,"top"),i=r(t,"left");return new s(e.left+i,e.top+n)},e.prototype.targetSize=function(){return s.targetSizeOf(this.element)},e.CLASS="zoom",e.EXPANDING_CLASS="zoom--expanding",e.EXPANDED_CLASS="zoom--expanded",e.COLLAPSING_CLASS="zoom--collapsing",e}(),M=function(){function e(e){this.element=e}return e.create=function(t){var n=document.createElement("img");return n.className=e.CLASS,n.src=t,n.addEventListener("load",function(){return n.classList.add(e.LOADED_CLASS)}),new e(n)},e.prototype.show=function(){this.element.classList.add(e.VISIBLE_CLASS)},e.prototype.isVisible=function(){return this.element.classList.contains(e.VISIBLE_CLASS)},e.prototype.hide=function(){this.element.classList.remove(e.VISIBLE_CLASS)},e.prototype.isHidden=function(){return!this.isVisible()},e.prototype.loaded=function(){this.element.classList.add(e.LOADED_CLASS)},e.prototype.isLoading=function(){return!this.isLoaded()},e.prototype.isLoaded=function(){return this.element.classList.contains(e.LOADED_CLASS)},e.CLASS="zoom__clone",e.VISIBLE_CLASS="zoom__clone--visible",e.LOADED_CLASS="zoom__clone--loaded",e}(),H=function(){function e(e){this.element=e}return e.create=function(){var t=document.createElement("div");return t.className=e.CLASS,new e(t)},e.prototype.appendTo=function(e){e.appendChild(this.element),t(this.element),this.show()},e.prototype.removeFrom=function(e){e.removeChild(this.element)},e.prototype.show=function(){this.element.classList.add(e.VISIBLE_CLASS)},e.prototype.hide=function(){this.element.classList.remove(e.VISIBLE_CLASS)},e.CLASS="zoom__overlay",e.VISIBLE_CLASS="zoom__overlay--visible",e}(),V=function(){function e(e,t,n,i,o){this.overlay=e,this.wrapper=t,this.container=n,this.image=i,this.clone=o}return e.useExisting=function(t){var n=H.create(),i=new b(t.parentElement),o=new P(i.parent()),r=new O(t);return o.srcOf(t)===t.src?new e(n,o,i,r):new e(n,o,i,r,new M(i.clone()))},e.setup=function(t){var n=H.create(),i=b.create(),o=new P(t.parentElement),r=new O(t),s=o.srcOf(t);return s===t.src?new e(n,o,i,r):new e(n,o,i,r,M.create(s))},e.prototype.replaceImageWithClone=function(){void 0!==this.clone&&(this.clone.show(),this.image.hide())},e.prototype.replaceCloneWithImage=function(){void 0!==this.clone&&(this.image.show(),this.clone.hide())},e.prototype.replaceContainerWithImage=function(){this.wrapper.element.replaceChild(this.container.element,this.image.element)},e.prototype.appendImageToContainer=function(){this.container.element.appendChild(this.image.element)},e.prototype.appendCloneToContainer=function(){void 0!==this.clone&&this.container.element.appendChild(this.clone.element)},e.prototype.fixWrapperHeight=function(){this.wrapper.element.style.height=m(this.image.element.height)},e.prototype.createCloneLoadedListener=function(){var e=this;return function(){void 0!==e.clone&&e.clone.isHidden()&&e.wrapper.isExpanded()&&e.replaceImageWithClone()}},e.prototype.removeCloneLoadedListener=function(e){void 0!==this.clone&&void 0!==e&&this.clone.isLoading()&&this.clone.element.removeEventListener("load",e)},e.prototype.showCloneIfLoaded=function(){void 0!==this.clone&&this.clone.isLoaded()&&this.clone.isHidden()&&this.replaceImageWithClone()},e}();function B(e){return void 0===e&&(e=window),void 0===e.pageYOffset?l(e.document).scrollTop:e.pageYOffset}function W(e,t,n){"function"==typeof t?t.call(e,n):t.handleEvent(n)}var k=function(){function e(e,t){this.target=e,this.delegate=t}return e.prototype.handleEvent=function(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),W(this.target,this.delegate,e))},e}(),F=function(){function e(e,t,n,i){this.target=e,this.start=t,this.distance=n,this.delegate=i}return e.prototype.handleEvent=function(e){Math.abs(this.start-B())>this.distance&&W(this.target,this.delegate,e)},e}(),G=function(){function e(e,t,n){this.delegateListener=e,this.scrollListener=t,this.escKeyListener=n}return e.create=function(t,n){return new e(n,new F(document,B(),t,n),new k(document,n))},e.prototype.addTo=function(e,t){t.addEventListener("click",this.delegateListener),e.addEventListener("scroll",this.scrollListener),e.document.addEventListener("keyup",this.escKeyListener)},e.prototype.removeFrom=function(e,t){t.removeEventListener("click",this.delegateListener),e.removeEventListener("scroll",this.scrollListener),e.document.removeEventListener("keyup",this.escKeyListener)},e}(),X=function(){function e(e,t,n){this.dom=e,this.features=t,this.targetSize=n,this._bounds=e.image.bounds()}return e.prototype.handleEvent=function(e){var t=this.dom.wrapper,n=this.dom.container;this._bounds=new x(t.position(),this._bounds.size),t.isTransitioning()?n.fillViewport(this.features,this.targetSize,this._bounds):n.setBounds(x.centreOf(document,this.targetSize,this._bounds))},Object.defineProperty(e.prototype,"bounds",{get:function(){return this._bounds},enumerable:!0,configurable:!0}),e}(),R=function(){function e(e,t,n){void 0===n&&(n=I),this.target=e,this.features=t,this.config=n}return e.prototype.handleEvent=function(e){var t=e.target;if(t instanceof HTMLImageElement&&t.classList.contains(O.CLASS)){var n=t.parentElement;if(n instanceof HTMLElement){var i,o;if(n.classList.contains(P.CLASS))o=!1,i=n;else{if(!n.classList.contains(b.CLASS))return;o=!0;var r=n.parentElement;if(!(r instanceof HTMLElement&&r.classList.contains(P.CLASS)))return;i=r}if(e.preventDefault(),e.stopPropagation(),e.metaKey||e.ctrlKey)window.open(N(i,t),"_blank");else{this.target.removeEventListener("click",this);var s=void 0;o?s=V.useExisting(t):((s=V.setup(t)).replaceContainerWithImage(),s.appendImageToContainer(),s.appendCloneToContainer());var a=void 0;void 0!==s.clone&&(s.clone.isLoaded()?s.replaceImageWithClone():(a=s.createCloneLoadedListener(),s.clone.element.addEventListener("load",a)));var c=s.wrapper.targetSize();this.features.hasTransform&&this.features.hasTransitions?this.zoomTransition(s,c,a):this.zoomInstant(s,c,a)}}}},e.prototype.zoomInstant=function(e,t,n){var i=this,o=new X(e,this.features,t),r=G.create(this.config.scrollDismissPx,function(){r.removeFrom(window,e.container.element),window.removeEventListener("resize",o),e.removeCloneLoadedListener(n),e.wrapper.collapsed(),e.container.resetBounds(),i.collapsed(e)});e.overlay.appendTo(document.body),e.wrapper.expanded(),e.fixWrapperHeight(),e.image.activate(),e.container.setBounds(x.centreOf(document,t,o.bounds)),window.addEventListener("resize",o),r.addTo(window,e.container.element)},e.prototype.zoomTransition=function(e,t,n){var i=this,o=this.features.transitionEndEvent,r=this.features.transitionProperty,s=this.features.transformProperty,a=new X(e,this.features,t),c=function(){e.showCloneIfLoaded(),e.wrapper.finishExpanding(),e.wrapper.expanded(),T(e.container.element,r,function(){e.container.resetStyle(s),e.container.setBounds(x.centreOf(document,t,a.bounds))}),e.container.element.removeEventListener(o,c)},l=G.create(this.config.scrollDismissPx,function(){l.removeFrom(window,e.container.element),window.removeEventListener("resize",a),e.removeCloneLoadedListener(n),e.overlay.hide(),e.wrapper.startCollapsing();var d=function(){i.collapsed(e),e.container.element.removeEventListener(o,d)};e.container.element.addEventListener(o,d),e.wrapper.isExpanding()?(e.container.element.removeEventListener(o,c),e.container.resetStyle(s),e.wrapper.finishExpanding()):(T(e.container.element,r,function(){e.container.fillViewport(i.features,t,a.bounds)}),e.container.resetStyle(s),e.container.resetBounds(),e.wrapper.collapsed())});e.overlay.appendTo(document.body),e.wrapper.startExpanding(),e.fixWrapperHeight(),e.image.activate(),e.container.element.addEventListener(o,c),e.container.fillViewport(this.features,t,a.bounds),l.addTo(window,e.container.element),window.addEventListener("resize",a)},e.prototype.collapsed=function(e){var t=this;e.replaceCloneWithImage(),e.overlay.removeFrom(document.body),e.image.deactivate(),e.wrapper.finishCollapsing(),setTimeout(function(){t.target.addEventListener("click",t)},1)},e}();e.listen=function(e){void 0===e&&(e=I),u(document,function(){var t=document.body,n=D.of(t.style),i=new R(t,n,e);t.addEventListener("click",i)})},e.DEFAULT_CONFIG=I,e.QUIRKS_MODE="BackCompat",e.STANDARDS_MODE=a,e.isStandardsMode=c,e.rootElement=l,e.viewportSize=d,e.ready=u,e.Features=D,e.VENDOR_PREFIXES=p,e.vendorProperties=f,e.vendorProperty=h,e.pageScrollY=B,e.Clone=M,e.Container=b,e.Image=O,e.fullSrc=N,e.Overlay=H,e.Wrapper=P,e.ZoomDOM=V,e.repaint=t,e.targetDimension=n,e.resetStyle=i,e.setBounds=o,e.parsePadding=r,e.ScaleAndTranslate=z,e.translate=v,e.translate3d=L,e.scale=y,e.scale3d=S,e.supports3dTransformations=g,e.TEST3D_ID=E,e.TEST3D_WIDTH=C,e.TEST3D_HEIGHT=w,e.TEST3D_STYLE=A,e.TRANSITION_END_EVENTS=_,e.ignoreTransitions=T,e.DismissListeners=G,e.EscKeyListener=k,e.fireEventListener=W,e.ZoomResizedListener=X,e.ScrollListener=F,e.ZoomListener=R,e.Bounds=x,e.pixels=m,e.Vector2=s,Object.defineProperty(e,"__esModule",{value:!0})});
